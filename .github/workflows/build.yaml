name: Build and Release Godot Project

permissions:
  contents: write

on:
  push:
    tags:
      - "v*.*.*"

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          lfs: true

      - name: Setup Godot 4
        uses: chickensoft-games/setup-godot@v2
        with:
          version: 4.2.1
          include-templates: true

      - name: Export Windows
        run: |
          mkdir -p build/windows
          godot --headless --export-release "Windows Desktop" build/windows/30-day-challenge.exe

      - name: Export Linux
        run: |
          mkdir -p build/linux
          godot --headless --export-release "Linux/X11" build/linux/30-day-challenge.x86_64

      - name: Zip builds
        run: |
          mkdir -p zips
          zip -r zips/30-day-challenge-windows.zip build/windows
          zip -r zips/30-day-challenge-linux.zip build/linux

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: zips/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
